DELIMITER $$;
CREATE AGGREGATE FUNCTION avg(x DOUBLE) RETURNS DOUBLE
BEGIN
     DECLARE count INT DEFAULT 0;
	DECLARE sum DOUBLE DEFAULT 0;
					DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' RETURN sum/count;
					LOOP
										FETCH GROUP NEXT ROW;
										SET count:=count+1;
										SET sum:=sum+x;
					END LOOP;
END
$$
DELIMITER ;$$
DROP FUNCTION TotalSum;

